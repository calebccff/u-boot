// SPDX-License-Identifier: GPL-2.0+
/*
 * Qualcomm QRB5165-RB5 evaluation board device tree source
 *
 * (C) Copyright 2023 Bhupesh Sharma <bhupesh.sharma@linaro.org>
 */

/dts-v1/;

#include "skeleton64.dtsi"
#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/clock/qcom,gcc-sm8250.h>
#include <dt-bindings/soc/qcom,rpmh-rsc.h>

/ {
	model = "Qualcomm Technologies, Inc. QRB5165 RB5";
	compatible = "qcom,qrb5165-rb5", "qcom,sm8250";
	#address-cells = <2>;
	#size-cells = <2>;

	chosen {
		stdout-path = "serial0:115200n8";
	};

	aliases {
		serial0 = &debug_uart;
	};

	memory {
		device_type = "memory";
		/*
		 * Enable this for sm8250-mtp:
		 */
		reg = <0x0 0x80000000 0x0 0x3C900000>,
		      <0x0 0xC0000000 0x0 0x80000000>,
		      <0x1 0x40000000 0x0 0xC0000000>;
		/*
		 * Enable this for rb5:
		 */
		// reg = <0x0 0x80000000 0x0 0x3B800000>,
		//       <0x0 0xC0000000 0x0 0xC0000000>,
		//       <0x1 0x80000000 0x1 0x00000000>;
	};

	psci {
		compatible = "arm,psci-1.0";
		method = "smc";
	};

	soc {
		#address-cells = <1>;
		#size-cells = <1>;
		ranges = <0 0 0 0xffffffff>;
		compatible = "simple-bus";

		apps_rsc: rsc@18200000 {
			label = "apps_rsc";
			compatible = "qcom,rpmh-rsc";
			reg = <0x18200000 0x10000>,
				<0x18210000 0x10000>,
				<0x18220000 0x10000>;
			reg-names = "drv-0", "drv-1", "drv-2";
			qcom,tcs-offset = <0xd00>;
			qcom,drv-id = <2>;
			qcom,tcs-config = <ACTIVE_TCS  2>, <SLEEP_TCS   3>,
					  <WAKE_TCS    3>, <CONTROL_TCS 1>;
		};

		tlmm: pinctrl_west@f100000 {
			compatible = "qcom,sm8250-pinctrl";
			reg = <0x0f100000 0x300000>,
			      <0x0f500000 0x300000>,
			      <0x0f900000 0x300000>;
			reg-names = "west", "south", "north";
			gpio-count = <181>;
			gpio-controller;
			#gpio-cells = <2>;
			gpio-ranges = <&tlmm 0 0 181>;

			/* DEBUG UART */
			debug_uart_on: debug-uart-default {
				pins = "GPIO_34", "GPIO_35";
				function = "qup12";
			};

			sdc2_default_state: sdc2-default-state {
				clk-pins {
					pins = "sdc2_clk";
					bias-disable;
					drive-strength = <16>;
				};

				cmd-pins {
					pins = "sdc2_cmd";
					bias-pull-up;
					drive-strength = <10>;
				};

				data-pins {
					pins = "sdc2_data";
					bias-pull-up;
					drive-strength = <10>;
				};
			};

			sdc2_card_det_n: sd-card-det-n-state {
				pins = "GPIO_77";
				function = "gpio";
			};
		};

		gcc: clock-controller@100000 {
			compatible = "qcom,gcc-sm8250";
			reg = <0x00100000 0x1f0000>;
			#clock-cells = <1>;
			#reset-cells = <1>;
			#power-domain-cells = <1>;
		};

		reset: gcc-reset@100000 {
			compatible = "qcom,gcc-reset-sm8250";
			reg = <0x00100000 0x1f0000>;
			#reset-cells = <1>;
		};

		debug_uart: serial@a90000 {
			compatible = "qcom,msm-geni-uart-v3-n-above";
			reg = <0x00a90000 0x4000>;
			clock-names = "se-clk";
			clocks = <&gcc GCC_QUPV3_WRAP1_S4_CLK>;
			pinctrl-names = "default";
			pinctrl-0 = <&debug_uart_on>;
		};

		sdhc_2: mmc@8804000 {
			compatible = "qcom,sm8250-sdhci", "qcom,sdhci-msm-v5";
			reg = <0x08804000 0x1000>;

			clocks = <&gcc GCC_SDCC2_AHB_CLK>,
				 <&gcc GCC_SDCC2_APPS_CLK>;
			clock-names = "iface", "core";

			resets = <&reset GCC_SDCC2_BCR>;

			cd-gpios = <&tlmm 77 GPIO_ACTIVE_LOW>; /* card detect gpio */
			//vmmc-supply = <&vreg_l9c_2p96>;
			//vqmmc-supply = <&vreg_l6c_2p96>;

			bus-width = <4>;
			no-sdio;
			no-mmc;

			pinctrl-names = "default";
			pinctrl-0 = <&sdc2_default_state &sdc2_card_det_n>;
		};

		ufs_mem_hc: ufshc@1d84000 {
			compatible = "qcom,sm8250-ufshc", "qcom,ufshc",
				     "jedec,ufs-2.0";
			reg = <0x01d84000 0x3000>;
			phys = <&ufs_mem_phy_lanes>;
			phy-names = "ufsphy";
			lanes-per-direction = <2>;
			#reset-cells = <1>;
			resets = <&reset GCC_UFS_PHY_BCR>;
			reset-names = "rst";

			power-domains = <&gcc UFS_PHY_GDSC>;

			clock-names =
				"core_clk",
				"bus_aggr_clk",
				"iface_clk",
				"core_clk_unipro",
				//"ref_clk",
				"tx_lane0_sync_clk",
				"rx_lane0_sync_clk",
				"rx_lane1_sync_clk";
			clocks =
				<&gcc GCC_UFS_PHY_AXI_CLK>,
				<&gcc GCC_AGGRE_UFS_PHY_AXI_CLK>,
				<&gcc GCC_UFS_PHY_AHB_CLK>,
				<&gcc GCC_UFS_PHY_UNIPRO_CORE_CLK>,
				//<&rpmhcc RPMH_CXO_CLK>,
				<&gcc GCC_UFS_PHY_TX_SYMBOL_0_CLK>,
				<&gcc GCC_UFS_PHY_RX_SYMBOL_0_CLK>,
				<&gcc GCC_UFS_PHY_RX_SYMBOL_1_CLK>;
			freq-table-hz =
				<37500000 300000000>,
				<0 0>,
				<0 0>,
				<37500000 300000000>,
				<0 0>,
				<0 0>,
				<0 0>,
				<0 0>;
		};

		ufs_mem_phy: phy@1d87000 {
			compatible = "qcom,sm8250-qmp-ufs-phy";
			reg = <0x01d87000 0x1c0>;
			#address-cells = <1>;
			#size-cells = <1>;
			ranges;
			clock-names = //"ref",
				      "ref_aux";
			clocks = //<&rpmhcc RPMH_CXO_CLK>,
				 <&gcc GCC_UFS_PHY_PHY_AUX_CLK>;

			resets = <&ufs_mem_hc 0>;
			reset-names = "ufsphy";

			ufs_mem_phy_lanes: phy@1d87400 {
				reg = <0x01d87400 0x16c>,
				      <0x01d87600 0x200>,
				      <0x01d87c00 0x200>,
				      <0x01d87800 0x16c>,
				      <0x01d87a00 0x200>;
				#phy-cells = <0>;
			};
		};

		usb_2_hsphy: phy@88e4000 {
			compatible = "qcom,sm8250-usb-hs-phy",
				     "qcom,usb-snps-hs-7nm-phy";
			reg = <0x088e4000 0x400>;
			#phy-cells = <0>;

			resets = <&reset GCC_QUSB2PHY_SEC_BCR>;
			reset-names = "phy";
		};

		usb_2_qmpphy: phy@88eb000 {
			compatible = "qcom,sm8250-qmp-usb3-uni-phy";
			reg = <0x088eb000 0x200>;
			#address-cells = <1>;
			#size-cells = <1>;
			ranges;

			clocks = <&gcc GCC_USB3_SEC_PHY_AUX_CLK>,
				 <&gcc GCC_USB3_SEC_CLKREF_EN>,
				 <&gcc GCC_USB3_SEC_PHY_COM_AUX_CLK>;
				 //<&gcc GCC_USB3_SEC_PHY_PIPE_CLK>;
			clock-names = "aux", "ref", "com_aux";

			resets = <&reset GCC_USB3PHY_PHY_SEC_BCR>,
				 <&reset GCC_USB3_PHY_SEC_BCR>;
			reset-names = "phy", "common";

			//#clock-cells = <0>;
			//clock-names = "pipe0";
			//clock-output-names = "usb3_uni_phy_pipe_clk_src";

			#phy-cells = <0>;
		};

		usb_2: usb@a8f8800 {
			compatible = "qcom,sm8250-dwc3", "qcom,dwc3";
			reg = <0x0a8f8800 0x400>;
			#address-cells = <1>;
			#size-cells = <1>;
			ranges;

			clocks = <&gcc GCC_CFG_NOC_USB3_SEC_AXI_CLK>,
				 <&gcc GCC_USB30_SEC_MASTER_CLK>,
				 <&gcc GCC_AGGRE_USB3_SEC_AXI_CLK>,
				 <&gcc GCC_USB30_SEC_SLEEP_CLK>,
				 <&gcc GCC_USB30_SEC_MOCK_UTMI_CLK>,
				 <&gcc GCC_USB3_SEC_CLKREF_EN>;
			clock-names = "cfg_noc",
				      "core",
				      "iface",
				      "sleep",
				      "mock_utmi",
				      "xo";

			assigned-clocks = <&gcc GCC_USB30_SEC_MOCK_UTMI_CLK>,
					  <&gcc GCC_USB30_SEC_MASTER_CLK>;
			assigned-clock-rates = <19200000>, <200000000>;

			power-domains = <&gcc USB30_SEC_GDSC>;

			resets = <&reset GCC_USB30_SEC_BCR>;

			usb_2_dwc3: usb@a800000 {
				compatible = "snps,dwc3";
				reg = <0x0a800000 0xcd00>;
				snps,dis_u2_susphy_quirk;
				snps,dis_enblslpm_quirk;
				phys = <&usb_2_hsphy>, <&usb_2_qmpphy>;
				phy-names = "usb2-phy", "usb3-phy";
				maximum-speed = "super-speed";
				dr_mode = "host";
			};
		};

		spmi@c440000 {
			compatible = "qcom,spmi-pmic-arb";
			reg = <0xc40a000 0x26000>,
			      <0xc440000 0x1100>,
			      <0x0e60000 0x100000>;
			reg-names = "cnfg", "core", "obsrvr";
			#address-cells = <1>;
			#size-cells = <0>;

			pm8150: pm8150@0 {
				compatible = "qcom,spmi-pmic";
				reg = <0x0 0x1>;
				#address-cells = <1>;
				#size-cells = <0>;

				pm8150_pon: pm8150_pon@800 {
					compatible = "qcom,pm8941-pwrkey";
					reg = <0x800 0x100>;
					#gpio-cells = <2>;
					gpio-controller;
					gpio-bank-name = "pm8941_key.";
				};

				pm8150_gpios: pm8150_gpios@c000 {
					compatible = "qcom,pm8941-gpio";
					reg = <0xc000>;
					gpio-controller;
					gpio-count = <10>;
					#gpio-cells = <2>;
					gpio-bank-name="pmic";
				};
			};

			pmic1: pm8150@1 {
				compatible = "qcom,spmi-pmic";
				reg = <0x1 0x0>;
				#address-cells = <0x2>;
				#size-cells = <0x0>;
			};
		};
	};
};

#include "qrb5165-rb5-uboot.dtsi"
